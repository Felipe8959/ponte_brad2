import mlflow
import mlflow.sklearn
from sklearn.neural_network import MLPClassifier

# ... (Todo o seu código de carregamento do BERT e geração dos embeddings X_train, y_train) ...

# 1. Inicia o Experimento no MLflow
# O Databricks organiza tudo em "Runs" (Execuções)
mlflow.set_experiment("/Users/seu_email@empresa.com/Projeto_Ouvidoria")

with mlflow.start_run(run_name="Treino_Hibrido_BERT_MLP") as run:
    
    # 2. Treina o modelo (Igual antes)
    print("Treinando...")
    clf = MLPClassifier(hidden_layer_sizes=(256, 128), max_iter=300, random_state=42)
    clf.fit(X_train, y_train)
    
    # 3. (Opcional) Salva métricas para gerar gráficos no Databricks
    acuracia = clf.score(X_val, y_val)
    mlflow.log_metric("acuracia_validacao", acuracia)
    
    # 4. SALVA O MODELO NO REGISTRY
    # registered_model_name -> Cria o modelo na aba "Models" do Databricks automaticamente
    print("Registrando modelo no Databricks...")
    mlflow.sklearn.log_model(
        sk_model=clf, 
        artifact_path="model",
        registered_model_name="Classificador_Ouvidoria_BERT"
    )
    
    print(f"Modelo salvo com sucesso! Run ID: {run.info.run_id}")
